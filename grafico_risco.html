<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js" integrity="sha256-R4pqcOYV8lt7snxMQO/HSbVCFRPMdrhAFMH+vr9giYI=" crossorigin="anonymous"></script>
</head>
<body>
    
    <canvas id="myChart1" width="400" height="400"></canvas>
    <canvas id="myChart2" width="400" height="400"></canvas>
    <canvas id="myChart3" width="400" height="400"></canvas>
    <script>

        let backgroundColors = [
            "#F77",
            "#FF7",
            "#7F7"
        ]

        let hoverBackgroundColors = [
            "#F00",
            "#FF0",
            "#0F0"
        ]

        // essa parte deve vir da API
        var graphData = [
            {
                title: "Distribuição de risco no 1o ano",
                data: [
                    [.1, .1],
                    [.3, .2],
                    [.6, .7]
                ]
            },
            {
                title: "Distribuição de risco no 2o ano",
                data: [
                    [.1, .0],
                    [.4, .2],
                    [.5, .8]
                ]
            },
            {
                title: "Distribuição de risco no 3o ano",
                data: [
                    [.3, .1],
                    [.1, .4],
                    [.6, .5]
                ]
            }
        ]

        var labels = [
            "Alto Risco",
            "Médio Risco",
            "Baixo Risco",
        ]

        const renderChart = (ctx, graph_index) =>{ 
            
            datasets = graphData[graph_index].data.map((d, index) => {
                return {
                    data: d,
                    label: labels[index],
                    backgroundColor: backgroundColors[index],
                    hoverBackgroundColor: hoverBackgroundColors[index],
                }
            })

            var data = {
                    labels: ['M', 'F'],
                    datasets: datasets
                };
                var options= {
                    title: {
                        display: true,
                        text: graphData[graph_index].title
                    },
                    tooltips: {
                        callbacks: {
                            label:function (value) {
                                if (value.xLabel === 0)
                                    return;
                                return (value.xLabel / 1 * 100).toFixed(0) + '%'; // convert it to percentage
                            }
                        } 
                    },
                    scales: {
                        yAxes: [{
                            stacked: true,
                            ticks: {
                                beginAtZero: true,
                            },
                            scaleLabel: {
                                display: true,
                                labelString: 'Porcentagem',
                            },
                        }],
                        xAxes: [
                            {
                                stacked: true,
                                ticks: {
                                callback: function (value) {
                                    return (value / this.max * 100).toFixed(0) + '%'; // convert it to percentage
                                }
                            }
                            },
                        ]
                    }
                };

            var myBarChart = new Chart(ctx, {
                type: 'horizontalBar',
                data: data,
                options: options
            });
            
            

    }

    for(let i=1; i < 4; i++) {
        var ctx = document.getElementById(`myChart${i}`).getContext('2d');

        renderChart(ctx, i-1);
    }

    </script>
</body>
